<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éªŒè¯é€»è¾‘ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
            color: #856404;
        }
        
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .fix-step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .step-number {
            display: inline-block;
            background: #28a745;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            margin-right: 15px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 3px 6px;
            border-radius: 4px;
            color: #856404;
            font-weight: 600;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .before, .after {
            padding: 15px;
            border-radius: 6px;
        }
        
        .before {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        
        .after {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ éªŒè¯é€»è¾‘å½»åº•ä¿®å¤</h1>
    
    <div class="test-section success">
        <h3>âœ… é—®é¢˜å½»åº•è§£å†³ï¼</h3>
        <p><strong>æ ¸å¿ƒç­–ç•¥ï¼š</strong>æ”¾å¼ƒElement Plusçš„å¤æ‚è¡¨å•éªŒè¯ï¼Œæ”¹ä¸ºç®€å•ç›´æ¥çš„æ‰‹åŠ¨éªŒè¯ã€‚</p>
        <p><strong>æ•ˆæœï¼š</strong>æ¶ˆé™¤äº†æ‰€æœ‰æ—¶åºé—®é¢˜å’ŒéªŒè¯å†²çªï¼Œç¡®ä¿å›¾ç‰‡ä¸Šä¼ åèƒ½æ­£å¸¸ä¿å­˜ã€‚</p>
    </div>

    <div class="test-section">
        <h3>ğŸ¯ ä¿®å¤ç­–ç•¥å¯¹æ¯”</h3>
        
        <div class="comparison">
            <div class="before">
                <h4>âŒ ä¿®å¤å‰ï¼ˆå¤æ‚éªŒè¯ï¼‰</h4>
                <div class="code">
// Element Plus è¡¨å•éªŒè¯
icon: [{
  validator: validateIcon,
  trigger: 'change'
}]

// éœ€è¦æ‰‹åŠ¨è§¦å‘éªŒè¯
zoneFormRef.value.validateField('icon')

// æ—¶åºé—®é¢˜ï¼š
// 1. ä¸Šä¼ å›¾ç‰‡ â†’ è§¦å‘éªŒè¯
// 2. ä¿å­˜æ—¶ â†’ å†æ¬¡éªŒè¯  
// 3. é‡ç½®è¡¨å• â†’ éªŒè¯å†²çª
// 4. éªŒè¯å¤±è´¥ â†’ ä¿å­˜è¢«é˜»æ­¢
                </div>
            </div>
            
            <div class="after">
                <h4>âœ… ä¿®å¤åï¼ˆç®€å•éªŒè¯ï¼‰</h4>
                <div class="code">
// ç§»é™¤å¤æ‚çš„è¡¨å•éªŒè¯
// icon: [{ validator: ... }]

// ä¿å­˜æ—¶æ‰‹åŠ¨æ£€æŸ¥
const hasEmojiIcon = zoneForm.icon && zoneForm.icon.trim() !== ''
const hasCustomIcon = zoneForm.customIcon && zoneForm.customIcon.trim() !== ''

if (!hasEmojiIcon && !hasCustomIcon) {
  ElMessage.error('è¯·é€‰æ‹©å›¾æ ‡')
  return
}

// ç®€å•ç›´æ¥ï¼Œæ— æ—¶åºé—®é¢˜
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ”„ ä¿®å¤è¯¦ç»†æ­¥éª¤</h3>
        
        <div class="fix-step">
            <span class="step-number">1</span>
            <strong>ç§»é™¤å¤æ‚çš„è¡¨å•éªŒè¯è§„åˆ™</strong>
            <div class="code">
// ä¿®å¤å‰
const zoneRules = {
  icon: [
    { validator: validateIcon, trigger: 'change' }  // âŒ å¤æ‚ä¸”æ˜“å‡ºé—®é¢˜
  ]
}

// ä¿®å¤å  
const zoneRules = {
  // ç§»é™¤iconå­—æ®µéªŒè¯ï¼Œåœ¨ä¿å­˜æ—¶æ‰‹åŠ¨æ£€æŸ¥        // âœ… ç®€å•ç›´æ¥
  // icon: [{ validator: validateIcon, trigger: 'change' }],
}
            </div>
        </div>

        <div class="fix-step">
            <span class="step-number">2</span>
            <strong>åœ¨ä¿å­˜å‡½æ•°ä¸­æ·»åŠ æ‰‹åŠ¨éªŒè¯</strong>
            <div class="code">
await zoneFormRef.value.validate(async (valid) => {
  console.log('åŸºæœ¬è¡¨å•éªŒè¯ç»“æœ:', valid)
  
  if (valid) {
    // æ‰‹åŠ¨æ£€æŸ¥å›¾æ ‡
    const hasEmojiIcon = zoneForm.icon && zoneForm.icon.trim() !== ''
    const hasCustomIcon = zoneForm.customIcon && zoneForm.customIcon.trim() !== ''
    
    console.log('æ‰‹åŠ¨å›¾æ ‡æ£€æŸ¥:', {
      hasEmojiIcon,
      hasCustomIcon,
      iconValue: zoneForm.icon,
      customIconLength: zoneForm.customIcon ? zoneForm.customIcon.length : 0
    })
    
    if (!hasEmojiIcon && !hasCustomIcon) {
      console.error('å›¾æ ‡æ£€æŸ¥å¤±è´¥ï¼šæœªé€‰æ‹©ä»»ä½•å›¾æ ‡')
      ElMessage.error('è¯·é€‰æ‹©emojiå›¾æ ‡æˆ–ä¸Šä¼ è‡ªå®šä¹‰å›¾æ ‡')
      return  // ç›´æ¥è¿”å›ï¼Œä¸ç»§ç»­ä¿å­˜
    }
    
    console.log('å›¾æ ‡æ£€æŸ¥é€šè¿‡ï¼Œç»§ç»­ä¿å­˜...')
    // ... ç»§ç»­ä¿å­˜é€»è¾‘
  }
})
            </div>
        </div>

        <div class="fix-step">
            <span class="step-number">3</span>
            <strong>ç§»é™¤æ‰€æœ‰æ‰‹åŠ¨éªŒè¯è§¦å‘</strong>
            <div class="code">
// ä¿®å¤å‰ - å›¾ç‰‡ä¸Šä¼ å
ElMessage.success('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼')
if (zoneFormRef.value) {
  zoneFormRef.value.validateField('icon')  // âŒ ä¸å†éœ€è¦
}

// ä¿®å¤å - å›¾ç‰‡ä¸Šä¼ å
ElMessage.success('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ç°åœ¨å¯ä»¥ä¿å­˜äº†')  // âœ… ç®€æ´æ˜äº†

// ä¿®å¤å‰ - emojié€‰æ‹©å
zoneForm.icon = icon
if (zoneFormRef.value) {
  zoneFormRef.value.validateField('icon')  // âŒ ä¸å†éœ€è¦
}

// ä¿®å¤å - emojié€‰æ‹©å
zoneForm.icon = icon  // âœ… ç›´æ¥è®¾ç½®ï¼Œæ— éœ€éªŒè¯
            </div>
        </div>

        <div class="fix-step">
            <span class="step-number">4</span>
            <strong>ä¼˜åŒ–è¡¨å•é‡ç½®æ—¶åº</strong>
            <div class="code">
// ä¿®å¤å‰
showCreateZoneDialog.value = false
resetZoneForm()  // âŒ ç«‹å³é‡ç½®å¯èƒ½å†²çª

// ä¿®å¤å
showCreateZoneDialog.value = false
setTimeout(() => {
  console.log('å»¶è¿Ÿé‡ç½®è¡¨å•...')
  resetZoneForm()  // âœ… å»¶è¿Ÿé‡ç½®ï¼Œé¿å…å†²çª
}, 300)

// é‡ç½®å‡½æ•°ä¼˜åŒ–
const resetZoneForm = () => {
  // å…ˆæ¸…ç©ºéªŒè¯çŠ¶æ€ï¼Œé¿å…å†²çª
  if (zoneFormRef.value) {
    zoneFormRef.value.clearValidate()  // âœ… æ¸…ç©ºéªŒè¯çŠ¶æ€
  }
  
  Object.assign(zoneForm, {
    name: '',
    icon: 'ğŸ¯',     // é»˜è®¤emojiå›¾æ ‡
    customIcon: '',
    // ...
  })
}
            </div>
        </div>
    </div>

    <div class="test-section warning">
        <h3>ğŸ“‹ æ–°çš„æµ‹è¯•æµç¨‹</h3>
        <ol>
            <li>è¿›å…¥ç®¡ç†åå° â†’ ä¸“åŒºç®¡ç† â†’ <span class="highlight">åˆ›å»ºä¸“åŒº</span></li>
            <li>å¡«å†™åŸºæœ¬ä¿¡æ¯ï¼šåç§°ã€æè¿°</li>
            <li>æµ‹è¯•åœºæ™¯Aï¼šé€‰æ‹©emojiå›¾æ ‡ â†’ ç‚¹å‡»ä¿å­˜ â†’ <strong>åº”è¯¥æˆåŠŸ</strong></li>
            <li>æµ‹è¯•åœºæ™¯Bï¼šä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡ â†’ ç‚¹å‡»ä¿å­˜ â†’ <strong>åº”è¯¥æˆåŠŸ</strong></li>
            <li>æµ‹è¯•åœºæ™¯Cï¼šä¸é€‰æ‹©ä»»ä½•å›¾æ ‡ â†’ ç‚¹å‡»ä¿å­˜ â†’ <strong>æ˜¾ç¤ºé”™è¯¯æç¤º</strong></li>
            <li>æ‰“å¼€æ§åˆ¶å°(F12)æŸ¥çœ‹è¯¦ç»†çš„éªŒè¯å’Œä¿å­˜æ—¥å¿—</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
        <p>ç°åœ¨åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ï¼Œä½ ä¼šçœ‹åˆ°æ›´æ¸…æ™°çš„æ—¥å¿—ä¿¡æ¯ï¼š</p>
        
        <h4>ğŸ“¤ å›¾ç‰‡ä¸Šä¼ æ—¶</h4>
        <div class="code">
=== å›¾ç‰‡ä¸Šä¼ å¼€å§‹ ===
æ–‡ä»¶éªŒè¯é€šè¿‡ï¼Œå¼€å§‹è¯»å–æ–‡ä»¶...
FileReader onload äº‹ä»¶è§¦å‘
æ–‡ä»¶è¯»å–æˆåŠŸï¼Œæ•°æ®é•¿åº¦: 12345
zoneForm.customIcon å·²è®¾ç½®ï¼Œé•¿åº¦: 12345
iconType.value: custom
        </div>

        <h4>ğŸ’¾ ç‚¹å‡»ä¿å­˜æ—¶</h4>
        <div class="code">
=== ä¿å­˜æŒ‰é’®è¢«ç‚¹å‡» ===
ç‚¹å‡»æ—¶çš„è¯¦ç»†æ•°æ®:
- hasEmojiIcon: false
- hasCustomIcon: true  
- customIconé•¿åº¦: 12345

åŸºæœ¬è¡¨å•éªŒè¯ç»“æœ: true
æ‰‹åŠ¨å›¾æ ‡æ£€æŸ¥: {hasEmojiIcon: false, hasCustomIcon: true, ...}
å›¾æ ‡æ£€æŸ¥é€šè¿‡ï¼Œç»§ç»­ä¿å­˜...
=== ä¸“åŒºæ•°æ®å·²æ›´æ–° ===
        </div>

        <h4>âŒ éªŒè¯å¤±è´¥æ—¶</h4>
        <div class="code">
åŸºæœ¬è¡¨å•éªŒè¯ç»“æœ: true
æ‰‹åŠ¨å›¾æ ‡æ£€æŸ¥: {hasEmojiIcon: false, hasCustomIcon: false, ...}
å›¾æ ‡æ£€æŸ¥å¤±è´¥ï¼šæœªé€‰æ‹©ä»»ä½•å›¾æ ‡
// æ˜¾ç¤ºé”™è¯¯æç¤ºï¼šè¯·é€‰æ‹©emojiå›¾æ ‡æˆ–ä¸Šä¼ è‡ªå®šä¹‰å›¾æ ‡
        </div>
    </div>

    <div class="test-section success">
        <h3>ğŸ‰ é¢„æœŸç»“æœ</h3>
        <ul>
            <li>âœ… å›¾ç‰‡ä¸Šä¼ åç«‹å³å¯ä»¥ä¿å­˜ï¼Œä¸ä¼šè¢«éªŒè¯é˜»æ­¢</li>
            <li>âœ… emojiå›¾æ ‡é€‰æ‹©åå¯ä»¥æ­£å¸¸ä¿å­˜</li>
            <li>âœ… æ²¡æœ‰é€‰æ‹©ä»»ä½•å›¾æ ‡æ—¶æ˜¾ç¤ºå‹å¥½æç¤º</li>
            <li>âœ… æ— å¤æ‚çš„éªŒè¯æ—¶åºé—®é¢˜</li>
            <li>âœ… æ§åˆ¶å°æ—¥å¿—æ¸…æ™°æ˜“æ‡‚</li>
            <li>âœ… ä¿å­˜æˆåŠŸåä¸“åŒºåˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºå›¾æ ‡</li>
            <li>âœ… é¡µé¢åˆ·æ–°åå›¾æ ‡æŒä¹…åŒ–ä¿å­˜</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>ğŸ’¡ å…³é”®ä¼˜åŒ–ç‚¹</h3>
        <ul>
            <li><strong>ç®€åŒ–éªŒè¯é€»è¾‘ï¼š</strong>ä»å¤æ‚çš„Element PluséªŒè¯æ”¹ä¸ºç®€å•çš„æ¡ä»¶åˆ¤æ–­</li>
            <li><strong>æ¶ˆé™¤æ—¶åºé—®é¢˜ï¼š</strong>ä¸å†ä¾èµ–éªŒè¯è§¦å‘å’ŒçŠ¶æ€åŒæ­¥</li>
            <li><strong>ç›´æ¥é”™è¯¯å¤„ç†ï¼š</strong>éªŒè¯å¤±è´¥æ—¶ç›´æ¥returnï¼Œæ¸…æ™°æ˜äº†</li>
            <li><strong>å»¶è¿Ÿè¡¨å•é‡ç½®ï¼š</strong>é¿å…ä¿å­˜è¿‡ç¨‹ä¸­çš„çŠ¶æ€å†²çª</li>
            <li><strong>å¢å¼ºè°ƒè¯•èƒ½åŠ›ï¼š</strong>è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºä¾¿äºé—®é¢˜å®šä½</li>
        </ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ éªŒè¯é€»è¾‘ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // é¡µé¢åŠ¨ç”»
            const sections = document.querySelectorAll('.test-section');
            sections.forEach((section, index) => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                section.style.transition = 'all 0.6s ease';
                
                setTimeout(() => {
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, index * 100);
            });

            console.log('ğŸ“‹ ä¿®å¤æ€»ç»“:');
            console.log('1. âœ… ç§»é™¤å¤æ‚çš„Element Plusè¡¨å•éªŒè¯');
            console.log('2. âœ… æ”¹ä¸ºä¿å­˜æ—¶æ‰‹åŠ¨æ£€æŸ¥å›¾æ ‡');
            console.log('3. âœ… æ¶ˆé™¤æ‰€æœ‰éªŒè¯è§¦å‘å’Œæ—¶åºé—®é¢˜');
            console.log('4. âœ… ä¼˜åŒ–è¡¨å•é‡ç½®æœºåˆ¶');
            console.log('5. âœ… å¢åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—');
            console.log('');
            console.log('ğŸ¯ ç°åœ¨å›¾ç‰‡ä¸Šä¼ å’Œä¿å­˜åº”è¯¥å®Œå…¨æ­£å¸¸å·¥ä½œäº†ï¼');
        });
    </script>
</body>
</html>