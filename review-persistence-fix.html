<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯„è®ºæŒä¹…åŒ–ä¿å­˜ä¿®å¤</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .fix-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
            color: #856404;
        }
        
        .info {
            border-left-color: #17a2b8;
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .before, .after {
            padding: 15px;
            border-radius: 6px;
        }
        
        .before {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        
        .after {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        
        .step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .step-number {
            display: inline-block;
            background: #28a745;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            margin-right: 15px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 3px 6px;
            border-radius: 4px;
            color: #856404;
            font-weight: 600;
        }
        
        .flow-diagram {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .flow-arrow {
            margin: 0 15px;
            color: #6c757d;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>ğŸ’¬ è¯„è®ºæŒä¹…åŒ–ä¿å­˜ä¿®å¤</h1>
    
    <div class="fix-section success">
        <h3>âœ… é—®é¢˜å·²ä¿®å¤ï¼</h3>
        <p><strong>é—®é¢˜ï¼š</strong>è´­ä¹°é¡µé¢çš„ç”¨æˆ·è¯„è®ºæ— æ³•æŒä¹…åŒ–ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢åè¯„è®ºæ¶ˆå¤±ã€‚</p>
        <p><strong>è§£å†³ï¼š</strong>æ·»åŠ äº†å®Œæ•´çš„è¯„è®ºæ•°æ®localStorageå­˜å‚¨å’ŒåŠ è½½æœºåˆ¶ï¼Œç¡®ä¿è¯„è®ºæ•°æ®æŒä¹…åŒ–ä¿å­˜ã€‚</p>
    </div>

    <div class="fix-section error">
        <h3>ğŸ› é—®é¢˜åˆ†æ</h3>
        
        <h4>æ ¹æœ¬åŸå› </h4>
        <p>è¯„è®ºæäº¤ååªæ›´æ–°äº†å†…å­˜ä¸­çš„äº§å“æ•°æ®ï¼Œæ²¡æœ‰ä¿å­˜åˆ°localStorageï¼š</p>
        <div class="code">
const submitReview = async () => {
  // ... åˆ›å»ºè¯„è®ºå¯¹è±¡ ...
  
  // âŒ åªæ·»åŠ åˆ°å†…å­˜ä¸­
  currentReviewProduct.value.reviews.unshift(review)
  updateProductRating(currentReviewProduct.value)
  
  // âŒ æ²¡æœ‰ä¿å­˜åˆ°localStorageï¼Œåˆ·æ–°é¡µé¢æ•°æ®ä¸¢å¤±
  ElMessage.success('è¯„ä»·æäº¤æˆåŠŸ')
}
        </div>

        <h4>æ•°æ®æµé—®é¢˜</h4>
        <div class="flow-diagram">
            <div class="flow-step">
                <span>ç”¨æˆ·æäº¤è¯„è®º</span>
                <span class="flow-arrow">â†’</span>
                <span>æ·»åŠ åˆ°å†…å­˜æ•°ç»„</span>
                <span class="flow-arrow">â†’</span>
                <span class="highlight">âŒ æœªä¿å­˜åˆ°localStorage</span>
            </div>
            <div class="flow-step">
                <span>é¡µé¢åˆ·æ–°</span>
                <span class="flow-arrow">â†’</span>
                <span>é‡æ–°åŠ è½½æ•°æ®</span>
                <span class="flow-arrow">â†’</span>
                <span class="highlight">âŒ è¯„è®ºæ•°æ®ä¸¢å¤±</span>
            </div>
        </div>
    </div>

    <div class="fix-section">
        <h3>ğŸ”§ ä¿®å¤æ–¹æ¡ˆ</h3>
        
        <div class="comparison">
            <div class="before">
                <h4>âŒ ä¿®å¤å‰</h4>
                <div class="code">
const submitReview = async () => {
  // åˆ›å»ºè¯„è®º
  const review = { ... }
  
  // åªæ›´æ–°å†…å­˜æ•°æ®
  currentReviewProduct.value.reviews.unshift(review)
  updateProductRating(currentReviewProduct.value)
  
  ElMessage.success('è¯„ä»·æäº¤æˆåŠŸ')
  closeReviewDialog()
}

// é¡µé¢åŠ è½½æ—¶
const loadData = () => {
  // åªåŠ è½½äº§å“æ•°æ®ï¼Œæ²¡æœ‰è¯„è®ºæ•°æ®
  const savedProducts = localStorage.getItem('card_products')
  // ...
}
                </div>
            </div>
            
            <div class="after">
                <h4>âœ… ä¿®å¤å</h4>
                <div class="code">
const submitReview = async () => {
  // åˆ›å»ºè¯„è®º
  const review = { ... }
  
  // æ›´æ–°å†…å­˜æ•°æ®
  currentReviewProduct.value.reviews.unshift(review)
  updateProductRating(currentReviewProduct.value)
  
  // âœ… ä¿å­˜è¯„è®ºæ•°æ®åˆ°localStorage
  saveReviewsData()
  
  ElMessage.success('è¯„ä»·æäº¤æˆåŠŸ')
  closeReviewDialog()
}

// é¡µé¢åŠ è½½æ—¶
const loadData = () => {
  // åŠ è½½äº§å“æ•°æ®
  // ...
  
  // âœ… åŠ è½½è¯„è®ºæ•°æ®
  setTimeout(() => {
    loadReviewsData()
  }, 100)
}
                </div>
            </div>
        </div>

        <h4>è¯¦ç»†ä¿®å¤æ­¥éª¤</h4>
        
        <div class="step">
            <span class="step-number">1</span>
            <strong>æ·»åŠ è¯„è®ºæ•°æ®ä¿å­˜å‡½æ•°</strong>
            <div class="code">
// ä¿å­˜è¯„è®ºæ•°æ®åˆ°localStorage
const saveReviewsData = () => {
  try {
    console.log('=== ä¿å­˜è¯„è®ºæ•°æ® ===')
    
    // æ”¶é›†æ‰€æœ‰äº§å“çš„è¯„è®ºæ•°æ®
    const allReviewsData = {}
    
    // ä» products æ•°ç»„ä¸­æ”¶é›†è¯„è®º
    products.value.forEach(product => {
      if (product.reviews && product.reviews.length > 0) {
        allReviewsData[product.id] = {
          reviews: product.reviews,
          rating: product.rating,
          reviewCount: product.reviewCount
        }
      }
    })
    
    // ä¿å­˜åˆ°localStorage
    localStorage.setItem('product_reviews', JSON.stringify(allReviewsData))
    console.log('è¯„è®ºæ•°æ®ä¿å­˜æˆåŠŸï¼Œå…±', Object.keys(allReviewsData).length, 'ä¸ªäº§å“æœ‰è¯„è®º')
    
  } catch (error) {
    console.error('ä¿å­˜è¯„è®ºæ•°æ®å¤±è´¥:', error)
    ElMessage.error('ä¿å­˜è¯„è®ºå¤±è´¥')
  }
}
            </div>
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <strong>æ·»åŠ è¯„è®ºæ•°æ®åŠ è½½å‡½æ•°</strong>
            <div class="code">
// ä» localStorage åŠ è½½è¯„è®ºæ•°æ®
const loadReviewsData = () => {
  try {
    console.log('=== åŠ è½½è¯„è®ºæ•°æ® ===')
    
    const savedReviews = localStorage.getItem('product_reviews')
    if (!savedReviews) {
      console.log('æœªæ‰¾åˆ°å·²ä¿å­˜çš„è¯„è®ºæ•°æ®')
      return
    }
    
    const reviewsData = JSON.parse(savedReviews)
    console.log('åŠ è½½åˆ°', Object.keys(reviewsData).length, 'ä¸ªäº§å“çš„è¯„è®ºæ•°æ®')
    
    // å°†è¯„è®ºæ•°æ®åˆ†é…ç»™å¯¹åº”çš„äº§å“
    products.value.forEach(product => {
      if (reviewsData[product.id]) {
        const reviewData = reviewsData[product.id]
        product.reviews = reviewData.reviews
        product.rating = reviewData.rating
        product.reviewCount = reviewData.reviewCount
        console.log(`æ¢å¤äº§å“ ${product.id} ("${product.name}") çš„è¯„è®º:`, product.reviewCount, 'æ¡')
      }
    })
    
    console.log('è¯„è®ºæ•°æ®åŠ è½½å®Œæˆ')
    
  } catch (error) {
    console.error('åŠ è½½è¯„è®ºæ•°æ®å¤±è´¥:', error)
  }
}
            </div>
        </div>

        <div class="step">
            <span class="step-number">3</span>
            <strong>åœ¨è¯„è®ºæäº¤åä¿å­˜æ•°æ®</strong>
            <div class="code">
const submitReview = async () => {
  // ... è¯„è®ºåˆ›å»ºå’ŒéªŒè¯é€»è¾‘ ...
  
  // å°†è¯„ä»·æ·»åŠ åˆ°äº§å“çš„è¯„ä»·åˆ—è¡¨ä¸­
  if (!currentReviewProduct.value.reviews) {
    currentReviewProduct.value.reviews = []
  }
  currentReviewProduct.value.reviews.unshift(review)
  
  // æ›´æ–°äº§å“è¯„åˆ†
  updateProductRating(currentReviewProduct.value)
  
  // âœ… ä¿å­˜è¯„è®ºæ•°æ®åˆ°localStorage
  saveReviewsData()

  ElMessage.success('è¯„ä»·æäº¤æˆåŠŸ')
  closeReviewDialog()
}
            </div>
        </div>

        <div class="step">
            <span class="step-number">4</span>
            <strong>åœ¨é¡µé¢åŠ è½½æ—¶æ¢å¤è¯„è®ºæ•°æ®</strong>
            <div class="code">
const loadData = () => {
  try {
    // åŠ è½½ä¸“åŒºæ•°æ®
    // ...
    
    // åŠ è½½å•†å“æ•°æ®
    // ...
    
    console.log('ğŸ’³ è´­ä¹°é¡µé¢æ•°æ®åŠ è½½å®Œæˆï¼Œä¸“åŒºæ•°é‡:', zones.value.length)
    
    // âœ… åœ¨æ‰€æœ‰æ•°æ®åŠ è½½å®ŒæˆååŠ è½½è¯„è®ºæ•°æ®
    setTimeout(() => {
      loadReviewsData()
    }, 100)
    
  } catch (error) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error)
  }
}
            </div>
        </div>
    </div>

    <div class="fix-section warning">
        <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
        <ol>
            <li>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°(F12) â†’ Consoleé€‰é¡¹å¡</li>
            <li>è®¿é—®è´­ä¹°å¡å¯†é¡µé¢</li>
            <li>ç‚¹å‡»ä»»æ„å•†å“æŸ¥çœ‹è¯¦æƒ… â†’ åˆ‡æ¢åˆ°"ç”¨æˆ·è¯„ä»·"é€‰é¡¹å¡</li>
            <li>ç‚¹å‡»"å†™è¯„ä»·"æŒ‰é’®ï¼Œå¡«å†™è¯„ä»·å†…å®¹å¹¶æäº¤</li>
            <li>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤çœ‹åˆ°ï¼š</li>
            <div class="code">
=== ä¿å­˜è¯„è®ºæ•°æ® ===
è¯„è®ºæ•°æ®ä¿å­˜æˆåŠŸï¼Œå…± 1 ä¸ªäº§å“æœ‰è¯„è®º
äº§å“ 123: 1 æ¡è¯„è®ºï¼Œè¯„åˆ† 5
            </div>
            <li>åˆ·æ–°é¡µé¢ï¼Œå†æ¬¡æŸ¥çœ‹è¯¥å•†å“çš„è¯„ä»·</li>
            <li>ç¡®è®¤è¯„è®ºä¾ç„¶å­˜åœ¨ï¼Œæ§åˆ¶å°æ˜¾ç¤ºï¼š</li>
            <div class="code">
=== åŠ è½½è¯„è®ºæ•°æ® ===
åŠ è½½åˆ° 1 ä¸ªäº§å“çš„è¯„è®ºæ•°æ®
æ¢å¤äº§å“ 123 ("å•†å“åç§°") çš„è¯„è®º: 1 æ¡
è¯„è®ºæ•°æ®åŠ è½½å®Œæˆ
            </div>
        </ol>
    </div>

    <div class="fix-section info">
        <h3>ğŸ” æ•°æ®ç»“æ„</h3>
        
        <h4>localStorageå­˜å‚¨æ ¼å¼</h4>
        <div class="code">
// localStorage.getItem('product_reviews')
{
  "123": {
    "reviews": [
      {
        "id": 1640995200000,
        "productId": 123,
        "userId": "user123",
        "userName": "å¼ ä¸‰",
        "avatar": "/default-avatar.jpg",
        "rating": 5,
        "content": "å•†å“å¾ˆä¸é”™ï¼ŒæœåŠ¡æ€åº¦å¾ˆå¥½ï¼",
        "images": [],
        "date": "2024-01-01T10:00:00.000Z",
        "likes": 0,
        "isHelpful": false
      }
    ],
    "rating": 5.0,
    "reviewCount": 1
  }
}
        </div>

        <h4>äº§å“å¯¹è±¡ç»“æ„</h4>
        <div class="code">
// productå¯¹è±¡åŒ…å«çš„è¯„è®ºç›¸å…³å­—æ®µ
{
  "id": 123,
  "name": "å•†å“åç§°",
  // ... å…¶ä»–äº§å“ä¿¡æ¯ ...
  
  "reviews": [...],        // è¯„è®ºæ•°ç»„
  "rating": 5.0,           // å¹³å‡è¯„åˆ†
  "reviewCount": 1         // è¯„è®ºæ€»æ•°
}
        </div>
    </div>

    <div class="fix-section success">
        <h3>ğŸ‰ ä¿®å¤æ•ˆæœ</h3>
        <ul>
            <li>âœ… è¯„è®ºæäº¤åè‡ªåŠ¨ä¿å­˜åˆ°localStorage</li>
            <li>âœ… é¡µé¢åˆ·æ–°åè¯„è®ºæ•°æ®å®Œæ•´æ¢å¤</li>
            <li>âœ… äº§å“è¯„åˆ†å’Œè¯„è®ºæ•°é‡æ­£ç¡®è®¡ç®—</li>
            <li>âœ… è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ä¾¿äºé—®é¢˜æ’æŸ¥</li>
            <li>âœ… é”™è¯¯å¤„ç†æœºåˆ¶ç¡®ä¿ç³»ç»Ÿç¨³å®š</li>
            <li>âœ… æ”¯æŒå¤šä¸ªäº§å“çš„è¯„è®ºæ•°æ®ç®¡ç†</li>
        </ul>
    </div>

    <div class="fix-section info">
        <h3>ğŸ’¡ æŠ€æœ¯ç»†èŠ‚</h3>
        
        <h4>ä¸ºä»€ä¹ˆä½¿ç”¨å»¶è¿ŸåŠ è½½</h4>
        <div class="code">
// å»¶è¿ŸåŠ è½½è¯„è®ºæ•°æ®ï¼Œç¡®ä¿äº§å“æ•°æ®å…ˆåŠ è½½å®Œæˆ
setTimeout(() => {
  loadReviewsData()
}, 100)

// åŸå› ï¼š
// 1. äº§å“æ•°æ®éœ€è¦å…ˆä»localStorageåŠ è½½
// 2. è¯„è®ºæ•°æ®ä¾èµ–äºäº§å“å¯¹è±¡çš„å­˜åœ¨
// 3. é¿å…ç«äº‰æ¡ä»¶å¯¼è‡´çš„æ•°æ®ä¸¢å¤±
        </div>

        <h4>æ•°æ®ä¸€è‡´æ€§ä¿è¯</h4>
        <div class="code">
// ä¿å­˜æ—¶æ”¶é›†æ‰€æœ‰äº§å“çš„æœ€æ–°è¯„è®ºæ•°æ®
products.value.forEach(product => {
  if (product.reviews && product.reviews.length > 0) {
    allReviewsData[product.id] = {
      reviews: product.reviews,      // å®Œæ•´è¯„è®ºåˆ—è¡¨
      rating: product.rating,        // å®æ—¶è®¡ç®—çš„å¹³å‡åˆ†
      reviewCount: product.reviewCount  // å®æ—¶è®¡ç®—çš„æ€»æ•°
    }
  }
})
        </div>

        <h4>é”™è¯¯å¤„ç†æœºåˆ¶</h4>
        <div class="code">
try {
  // æ•°æ®æ“ä½œ
  localStorage.setItem('product_reviews', JSON.stringify(allReviewsData))
} catch (error) {
  console.error('ä¿å­˜è¯„è®ºæ•°æ®å¤±è´¥:', error)
  ElMessage.error('ä¿å­˜è¯„è®ºå¤±è´¥')  // ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ’¬ è¯„è®ºæŒä¹…åŒ–ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // é¡µé¢åŠ¨ç”»
            const sections = document.querySelectorAll('.fix-section');
            sections.forEach((section, index) => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                section.style.transition = 'all 0.6s ease';
                
                setTimeout(() => {
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, index * 100);
            });

            console.log('ğŸ“‹ ä¿®å¤æ€»ç»“:');
            console.log('1. âœ… æ·»åŠ saveReviewsData()ä¿å­˜å‡½æ•°');
            console.log('2. âœ… æ·»åŠ loadReviewsData()åŠ è½½å‡½æ•°');
            console.log('3. âœ… åœ¨è¯„è®ºæäº¤åè°ƒç”¨ä¿å­˜å‡½æ•°');
            console.log('4. âœ… åœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨åŠ è½½å‡½æ•°');
            console.log('5. âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•æ—¥å¿—');
            console.log('');
            console.log('ğŸ¯ ç°åœ¨ç”¨æˆ·è¯„è®ºå¯ä»¥æŒä¹…åŒ–ä¿å­˜äº†ï¼');
        });
    </script>
</body>
</html>